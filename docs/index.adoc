= Shoppingmall Application 개발

== 개요
* 쇼핑몰 데이터베이스 설계를 기반으로 Shoppingmall Application을 개발 합니다.

== 개발환경
* tomcat9
* servlet 4.x
* jdk 11
* maven

== ERD 설계
* 쇼핑몰은 다음과 같은 주요 Entity가 포함되어야 합니다.

----

    관리자 : 회원 관리, 카테고리 관리, 상품관리

    회원 - 로그인, 회원가입, 비밀번호 변경

    상품 - 파일업로드, 상품은 썸네일 이미지와 상품이미지 10개까지 등록할 수 있습니다.

    주문

    장바구니

    결제

    상품문의 게시판

    포인트

    마이페이지(내정보, 주문내역, 장바구니, 로그아웃)

----

== 구현 요구사항

=== DataBase
* 제공해드린 MySQL 계정을 사용합니다.
* Table 생성시 Innodb Engine을 사용합니다.
* CharSet은 서버에 설정되어 있는 `utf8mb4` 를 사용합니다.

=== Connection Pool
* DBCP2 기반의 Connection Pool을 생성합니다.
* Connection Pool, link:{docdir}/../src/main/java/com/nhnacademy/shoppingmall/common/util/DbUtils.java[DbUtils.java] 는 Application 내에서 유일한 객체 입니다.

=== Transaction
* Isolation level : READ COMMITTED 설정합니다.
* AutoCommit을 사용하지 않습니다.
* Error가 발생하면 RollBack 합니다.

=== Front Servlet
* 모든 요청을 link:{docdir}/../src/main/java/com/nhnacademy/shoppingmall/servlet/FrontServlet.java[FrontServlet.java] 처리할 수 있도록 구현합니다.(Front Controller Pattern 적용)

** Controller는 link:{docdir}/../src/main/java/com/nhnacademy/shoppingmall/baseController/Command.java[Command] Interface 구현합니다.

* https://github.com/nhnacademy-bootcamp/java-servlet-jsp/blob/main/day03/01.MVC/index.adoc[MVC Model2, window=_blank] 기반으로 구현 합니다.
* 모든 에러는 FrontServlet에서 공통으로 에러처리 할 수 있도록 구현합니다.

== Web.xml(배치 기술자)
* xml 기반의 web.xml은 사용하지 않습니다.
* Annotation 기반으로 설정 합니다.

=== Filter
* link:{docdir}/../src/main/java/com/nhnacademy/shoppingmall/common/filter/CharacterEncodingFilter.java[CharacterEncodingFilter] 구현
** 한글이 정상 출력될 수 있도록 UTF-8 Encoding Filter 구현 합니다.

* link:{docdir}/../src/main/java/com/nhnacademy/shoppingmall/common/filter/LoginCheckFilter.java[LoginCheckFilter] 구현
** /mypage/ 하위 경로는 로그인한 사용자만 접근할 수 있습니다.

* link:{docdir}/../src/main/java/com/nhnacademy/shoppingmall/common/filter/AdminCheckFilter.java[AdminCheckFilter] 구현
** /admin/ 하위 경로는 관리자 권한을 가진 회원만 접근할 수 있습니다.

* link:{docdir}/../src/main/java/com/nhnacademy/shoppingmall/common/filter/JspAccessDeniedFilter.java[JspAccessDeniedFilter]
** '*.jsp' 요청은 404 페이지로 이동합니다.

=== Pagination
* page 는 1부터 시작합니다.
* 모든 페이징 처리는 link:{docdir}/../src/main/java/com/nhnacademy/shoppingmall/common/page/Page.java[Page.java, window=_blank] 기반으로 구현합니다.

=== View 구현
* View는 JSP를 사용합니다.
* JSP로 작성된 페이지는 반드시 FrontServlet에 의해서 호출되어야 합니다.
* 과도한 Scriptlet을 사용하지 않습니다.

=== 회원
* 사용자는 아이디, 비밀번호를 이용하여 로그인 합니다.
* 로그인을 하면 사용자를 식별할 수 있는 Session이 생성되며 60분동안 유지됩니다.
** SQL Injection을 방어할 수 있는 코드를 작성합니다.
* 사용자는 회원가입과 동시에 100만 포인트가 부여됩니다. ( 포인트를 사용해서 결제를 합니다.)

=== 상품
* 관리자 페이지에서 상품을 등록,수정,삭제 할 수 있습니다.
* 상품은 반드시 하나의 카테고리에 속해야 합니다.
* 위지윅 에디터는 사용하지 않습니다.

=== 최근본 상품구현
* 쇼핑몰 메인페이지에 최근본 상품 n개가 노출됩니다.
* 최근본 상품 구현시 Cookie, Session, DB등을 이용한 다양한 방법이 있습니다. 각 방법들으 장단점을 고려하여 한 가지 방법을 선택하여 구현합니다.
* 로그인 하지 않더라도 최근본 상품을 확인할 수 있어야 합니다.
* 왜 이렇게 구현했는지 최근본 상품구현.txt에 작성합니다.

=== 장바구니
* Session기반 장바구니를 구현합니다.
* 장바구니는 수량을 변경할 수 있습니다.
* 주문이 완료되면 해당 상품은 장바구니에서 삭제 됩니다.
* 상품을 중복해서 장바구니에 등록할 수 없습니다.

=== 주문
* 주문을 완료하면 포인트가 적립됩니다.
** 포인트 적립이 실패하더라도 주문은 정상처리됩니다.
*** 포인트 적립 실패에 대해서는 error로그로 기록합니다.
** 포인트 적립은 독립된 Thread 내에서 처리될 수 있도록 구현합니다.
* error 처리
** 주문수량이 부족하면 주문을 할 수 없습니다.
** 회원의 포인트 < 결제금액 이면 주문을 할 수 없습니다.

=== 포인트
* 제품을 주문하면 10%가 포인트로 적립됩니다.
* 포인트 사용이력을 확인할 수 있어야 합니다.

== Test Code 작성
* Repository Test를 작성합니다.
* 테스트 데이터는 RollBack 되어야 합니다.

